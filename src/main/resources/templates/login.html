<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>登录</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
    <link rel="stylesheet" th:href="@{/css/typo.css}">
    <link rel="stylesheet" th:href="@{/lib/editor/css/editormd.css}">
    <link rel="stylesheet" th:href="@{/lib/prism/prism.css}">
    <link rel="stylesheet" th:href="@{/lib/tocbot/tocbot.css}">
    <!--引入自定义的css-->
    <link rel="stylesheet" th:href="@{/css/me.css}">
    <link rel="stylesheet" th:href="@{/css/login.css}">
    <link rel="stylesheet" th:href="@{/css/background.css}">

</head>
<body>


<div class="container" id="container">
    <div class="form-container sign-up-container">
        <form id="formReg" action="#" method="post" enctype="multipart/form-data">
            <div class="social-container">
                <!--                <a href="#" class="social"><i class="fab fa-facebook-f"></i></a>-->
                <!--                <a href="#" class="social"><i class="fab fa-google-plus-g"></i></a>-->
                <!--                <a href="#" class="social"><i class="fab fa-linkedin-in"></i></a>-->
                <img th:src="@{/images/Volcano.jpg}"
                     width="100" height="100" id="imgs" class="border border-primary"
                     style="margin-bottom: 5px;
                     border-radius: 100%"
                     th:onclick="chooseImageFile('pic')">
                <input type="file" name="imgFile" id="pic" hidden="hidden" accept="image/*"
                       th:onchange="showImg('pic')">
            </div>
            <span th:onclick="chooseImageFile('pic')">点击图片以上传你的头像</span>
            <input type="text" id="nickname" name="nickname" placeholder="昵称"/>
            <input type="text" id="username" name="username" placeholder="用户名 (6至20位字母，数字，下划线)"/>
            <input type="password" id="password" name="password" placeholder="密码 (6至18位字母，数字)"/>
            <input type="email" id="email" name="email" placeholder="请输入邮箱"/>
            <input type="hidden" id="type" name="type" th:value="2">
            <a class="ui inverted red button" id="regButton">注册</a>
            <div class="ui negative message" id="errorDiv" style="
                 padding-top: 8px !important;
                 padding-bottom: 8px !important;
                 display: none">
                <p id="errorMsg" style="
                font-size: medium;font-family: sans-serif;font-weight: 500 !important;">
                    That offer has expired
                </p>
            </div>
        </form>
    </div>
    <div class="form-container sign-in-container">
        <form th:action="@{/logIn}" method="post">
            <h1>登录</h1>
            <div class="social-container">
                <a href="#" class="social"><i class="fab fa-facebook-f"></i></a>
                <a href="#" class="social"><i class="fab fa-google-plus-g"></i></a>
                <a href="#" class="social"><i class="fab fa-linkedin-in"></i></a>
            </div>
<!--            <span class="account" data-content="###############">or use your account</span>-->
            <input type="text" name="username" placeholder="用户名"/>
            <input type="password" name="password" placeholder="密码"/>
<!--            <a href="#" class="forget">Forgot your password?</a>-->
            <button type="submit">登录</button>
            <div class="ui negative message" th:if="${msg} != null"style="
                 padding-top: 8px !important;
                 padding-bottom: 8px !important;">
                <p th:text="${msg}" style="
                font-size: medium;font-family: sans-serif;font-weight: 500 !important;">
                    That offer has expired
                </p>
            </div>

        </form>
    </div>
    <div class="overlay-container">
        <div class="overlay">
            <div class="overlay-panel overlay-left">
                <h1>Welcome Back!</h1>
                <p>To keep connected with us please login with your personal info</p>
                <button class="ghost" id="signIn">Sign In</button>
            </div>
            <div class="overlay-panel overlay-right">
                <h1>Hello, Friend!</h1>
                <p>Enter your personal details and start journey with us</p>
                <button class="ghost" id="signUp">Sign Up</button>
            </div>
        </div>
    </div>
</div>



<!--/*/<th:block th:replace="_fragments :: script">/*/-->
<!--引入jquery-->
<script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
<!--/*/</th:block>/*/-->

<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/js/all.min.js"
        integrity="sha256-qM7QTJSlvtPSxVRjVWNM2OfTAz/3k5ovHOKmKXuYMO4=" crossorigin="anonymous"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/jquery.form/4.0.1/jquery.form.js"></script>


<script th:src="@{/js/login.js}"></script>

<script>

    // 打开file表单,选择图片
    function chooseImageFile(inputFileId) {
        $("#" + inputFileId).click();
    }

    // FileReader接口提供了一个异步的API，通过这个API可以从浏览器中异步访问文件系统中的数据。
    // 因此，FileReader接口可以读取文件中的数据，并将读取的数据放入到内存中去
    var imgReader = new FileReader();

    // 正则表达式，过滤图片文件
    regexImageFilter = /^(?:image\/bmp|image\/cis\-cod|image\/gif|image\/ief|image\/jpeg|image\/jpeg|image\/jpeg|image\/pipeg|image\/png|image\/svg\+xml|image\/tiff|image\/x\-cmu\-raster|image\/x\-cmx|image\/x\-icon|image\/x\-portable\-anymap|image\/x\-portable\-bitmap|image\/x\-portable\-graymap|image\/x\-portable\-pixmap|image\/x\-rgb|image\/x\-xbitmap|image\/x\-xpixmap|image\/x\-xwindowdump)$/i;

    function showImg(inputFileId) {
        // 获取图片
        var imgFile = $("#" + inputFileId).get(0).files[0];
        // 判断上传文件是否为图片
        if (!regexImageFilter.test(imgFile.type)) {
            console.log("请输入正确图片格式！");
        } else {
            imgReader.readAsDataURL(imgFile);
        }
        // 获取到图片后提交到后台保存
        var imgFile0 = new FormData($("#formReg")[0]);
        imgFile0.append('imgFile', $("#pic")[0].files[0]);
        $.ajax({
            url: 'upLoadImg',
            type: 'post',
            data: imgFile0,
            // 告诉jQeury不处理发送的数据
            processData: false,
            // 不设置Content-Type的请求头
            contentType: false,
            async: false,
            cache: false,
            success: function () {

            }
        });
    }

    // 读取图片
    imgReader.onload = function (evt) {
        $("#imgs").attr("src", evt.target.result);
    };

    // 异步验证注册信息
    $("#regButton").click(function () {
        var nickname = $("#nickname").val();
        var username = $("#username").val();
        var password = $("#password").val();
        var email = $("#email").val();
        // type = 2 默认注册用户都是普通用户，管理员 type = 1
        var type = $("#type").val();

        $.post({
            url: "registration",
            data: {
                "nickname": nickname,
                "username": username,
                "password": password,
                "email": email,
                "type": type
            },
            success: function (data) {
                if (data == "ok") {
                    // 成功后返回登陆界面，并关闭错误警告
                    $("#signIn").click();
                    document.getElementById("errorDiv").style.display="none";
                } else {
                    // 显示错误警告
                    document.getElementById("errorDiv").style.display="block";
                    if (data == "errorInput") {
                        $("#errorMsg").html("用户名与密码不合法！")
                    } else if (data == "usernameError") {
                        $("#errorMsg").html("用户名不合法！")
                    } else if (data == "passwordError") {
                        $("#errorMsg").html("密码不合法！")
                    } else if (data == "dupNicknameUsername") {
                        $("#errorMsg").html("昵称、用户名已存在！")
                    } else if (data == "dupNickname") {
                        $("#errorMsg").html("昵称已存在！")
                    } else if (data == "dupUsername") {
                        $("#errorMsg").html("用户名已存在！")
                    }
                }
            }
        })
    });

</script>
</body>


</html>